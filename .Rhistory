summarize(number = n()) |>
ggplot(aes(x = fct_reorder(x23_industry_sector, number, .desc = TRUE), y = number)) +
geom_col() +
labs(x = "Industry sector", y = "Number of facility chemical releases",
title = paste0(county, " Industry Releases")) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
return(g)
}
epa_data <- read.csv("raw_data/2024_ma.csv")
epa_data
county_plot <- function(data, county) {
g <- filtered <- data |>
filter(x7_county == county) |>
group_by(x23_industry_sector) |>
summarize(number = n()) |>
ggplot(aes(x = fct_reorder(x23_industry_sector, number, .desc = TRUE), y = number)) +
geom_col() +
labs(x = "Industry sector", y = "Number of facility chemical releases",
title = paste0(county, " Industry Releases")) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
return(g)
}
county_plot(epa_data, "ESSEX")
library(ggplot2)
library(dplyr)
county_plot(epa_data, "ESSEX")
library(janitor)
clean_names(epa_data)
epa_data <- clean_names(epa_data)
county_plot(epa_data, "ESSEX")
library(forcats)
county_plot(epa_data, "ESSEX")
View(epa_data)
county_plot <- function(data, county) {
data <- clean_names(data)
g <- filtered <- data |>
filter(x7_county == county) |>
group_by(x23_industry_sector) |>
summarize(number = n()) |>
ggplot(aes(x = fct_reorder(x23_industry_sector, number, .desc = TRUE), y = number)) +
geom_col() +
labs(x = "Industry sector", y = "Number of facility chemical releases",
title = paste0("Industry Releases", county, ", ", x8_st)) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
return(g)
}
county_plot(epa_data, "ESSEX")
county_plot <- function(data, county) {
data <- clean_names(data)
g <- filtered <- data |>
filter(x7_county == county) |>
group_by(x23_industry_sector) |>
summarize(number = n()) |>
ggplot(aes(x = fct_reorder(x23_industry_sector, number, .desc = TRUE), y = number)) +
geom_col() +
labs(x = "Industry sector", y = "Number of facility chemical releases",
title = paste0("Industry Releases", county, ", ", data$x8_st[[1]])) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
return(g)
}
county_plot(epa_data, "ESSEX")
county_plot(epa_data, "ESSEX")
county_plot <- function(data, county) {
data <- clean_names(data)
g <- filtered <- data |>
filter(x7_county == county) |>
group_by(x23_industry_sector) |>
summarize(number = n()) |>
ggplot(aes(x = fct_reorder(x23_industry_sector, number, .desc = TRUE), y = number)) +
geom_col() +
labs(x = "Industry sector", y = "Number of facility chemical releases",
title = paste0("Industry Releases in ", county, ", ", data$x8_st[[1]])) +
theme_bw() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
return(g)
}
county_plot(epa_data, "ESSEX")
devtools::document()
devtools::document()
rm(county_plot)
devtools::document()
rm(county_plot)
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
devtools::document()
use_build_ignore(raw_data)
use_build_ignore("raw_data")
?n
devtools::document()
devtools::document()
devtools::document()
?.data
devtools::document()
epa <- read.csv("raw_data/2024_ma.csv")
names(epa)
View(epa)
epa <- clean_names(epa)
library(janitor)
library(janitor)
epa <- clean_names(epa)
ggplot(epa, aes(x = x46_carcinogen)) +
geom_bar()
library(ggplot2)
ggplot(epa, aes(x = x46_carcinogen)) +
geom_bar()
sub1 <- epa[1:410]
sub1 <- epa[,1:410]
sub1 <- epa[1:122,1:410]
sub1 <- epa[1:410]
sub1 <- epa[1:410,]
sub2 <- epa[411:820,]
?case_when
epa <- epa |>
mutate(indicator = case_when(
x6_city == BOSTON ~ 1,
x6_city != BOSTON ~ 0
))
library(dplyr)
epa <- epa |>
mutate(indicator = case_when(
x6_city == BOSTON ~ 1,
x6_city != BOSTON ~ 0
))
epa <- epa |>
mutate(indicator = case_when(
x6_city == "BOSTON" ~ 1,
x6_city != "BOSTON" ~ 0
))
View(epa)
model <- glm(carcin ~ indicator, family = "binomial", data = epa)
epa <- epa |>
mutate(indicator = case_when(
x6_city == "BOSTON" ~ 1,
x6_city != "BOSTON" ~ 0
)) |>
mutate(carcin = case_when(
x46_carcinogen == "NO" ~ 0,
x46_carcinogen == "YES" ~ 1
))
model <- glm(carcin ~ indicator, family = "binomial", data = epa)
summary(model)
df <- epa |>
group_by(indicator) |>
summarize(n = n(carcin))
df <- epa |>
group_by(indicator) |>
summarize(n = sum(carcin))
df
epa <- epa |>
mutate(indicator = case_when(
x23_industry_sector == "Chemicals" ~ 1,
x23_industry_sector != "Chemicals" ~ 0
)) |>
mutate(carcin = case_when(
x46_carcinogen == "NO" ~ 0,
x46_carcinogen == "YES" ~ 1
))
df <- epa |>
group_by(indicator) |>
summarize(n = sum(carcin))
df
model <- glm(carcin ~ indicator, family = "binomial", data = epa)
summary(model)
df
df <- epa |>
group_by(indicator) |>
summarize(n = sum(carcin), prop = sum(carcin) / n())
df
model <- glm(prop ~ indicator, family = "binomial", data = df, weights = n)
df
df <- epa |>
group_by(indicator) |>
summarize(n =n(),
prop = mean(carcin))
df
model <- glm(prop ~ indicator, family = "binomial", data = df, weights = n)
summary(model)
exp(-0.52)
table(epa$x37_chemical)
data(epa)
epa <- read.csv("raw_data/2024_ma.csv")
library(janitor)
epa <- clean_names(epa)
epa_ma <- epa
View(epa_ma)
table(epa_ma$x37_chemical)
epa_tx <- read.csv("raw_data/2024_tx.csv")
table(epa_tx$x37_chemical)
epa_tx <- clean_names(epa_tx)
table(epa_tx$x37_chemical)
cor(epa_ma$x42_clean_air_act_chemical, epa_ma$x46_carcinogen)
?cor
mod <- glm(x46_carcinogen ~ x42_clean_air_act_chemical, data = epa_ma, family = binomial("logit"))
epa <- epa |>
mutate(indicator = case_when(
x23_industry_sector == "Chemicals" ~ 1,
x23_industry_sector != "Chemicals" ~ 0
)) |>
mutate(carcin = case_when(
x46_carcinogen == "NO" ~ 0,
x46_carcinogen == "YES" ~ 1
))
library(dplyr)
library(ggplot2)
epa <- epa |>
mutate(indicator = case_when(
x23_industry_sector == "Chemicals" ~ 1,
x23_industry_sector != "Chemicals" ~ 0
)) |>
mutate(carcin = case_when(
x46_carcinogen == "NO" ~ 0,
x46_carcinogen == "YES" ~ 1
))
df <- epa |>
group_by(indicator) |>
summarize(n = n(),
prop = mean(carcin))
model <- glm(prop ~ indicator, family = "binomial", data = df, weights = n)
summary(model)
epa_ma |>
summarize(total = sum(x107_total_releases))
epa_ma |>
group_by(x50_unit_of_measure) |>
summarize(total = sum(x107_total_releases))
epa_tx |>
group_by(x50_unit_of_measure) |>
summarize(total = sum(x107_total_releases))
data(2024_ma.csv)
data("2024_ma.csv")
ma_2024 <- read.csv("epar/raw_data/2024_ma.csv")
ma_2024 <- read.csv("raw_data/2024_ma.csv")
usethis::use_data(ma_2024)
load("C:/Users/zoede/Documents/epar/data/ma_2024.rda")
devtools::document()
devtools::document()
devtools::document()
library(janitor)
ma_2024 <- clean_names(ma_2024)
# Write this data into the package. Setting "overwrite = TRUE" is necessary if you need to rewrite the data set.
usethis::use_data(ma_2024, overwrite = TRUE)
devtools::document()
devtools::document()
devtools::document()
data("ma_2024")
ggplot(ma_2024, aes(x = x46_carcinogen)) +
geom_bar()
library(ggplot2)
library(dplyr)
ggplot(ma_2024, aes(x = x46_carcinogen)) +
geom_bar()
View(ma_2024)
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = sum(x23_industry_sector))
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n(x23_industry_sector))
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n())
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(x23_industry_sector))
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc())
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum))
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
max(sum)
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1)
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(x7_county, x23_industry_sector)
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(x7_county, x23_industry_sector) |>
rename(x23_industry_sector = "Top sector")
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(x7_county, x23_industry_sector) |>
rename("Top sector" = x23_industry_sector)
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(x7_county, x23_industry_sector) |>
rename("Top sector" = x23_industry_sector, "county" = x7_county)
?left_join
chemstats <- function(data, area = c("county", "city", "zip")) {
if (area == "county") {
temp <- data |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(!sum)
browser()
result <- data |>
group_by(x7_county) |>
summarize(num_chems = nrow(x7_county),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100) |>
left_join(temp,
by = x7_county)
}
}
chemstats <- function(data, area = c("county", "city", "zip")) {
if (area == "county") {
temp <- data |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(!sum)
#browser()
result <- data |>
group_by(x7_county) |>
summarize(num_chems = nrow(x7_county),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100) |>
left_join(temp,
by = x7_county)
}
}
chemstats(ma_2024, "county")
if (area == "county") {
temp <- data |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(!sum)
#browser()
names(data)
result <- data |>
group_by(x7_county) |>
summarize(num_chems = nrow(x7_county),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100) |>
left_join(temp,
by = x7_county)
}
chemstats <- function(data, area = c("county", "city", "zip")) {
if (area == "county") {
temp <- data |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(!sum)
#browser()
names(data)
result <- data |>
group_by(x7_county) |>
summarize(num_chems = nrow(x7_county),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100) |>
left_join(temp,
by = x7_county)
}
}
chemstats(ma_2024, "county")
names(ma_2024)
ma_2024 |> group_by(x7_county)
ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(!sum)
ma_2024 |>
group_by(x7_county) |>
summarize(num_chems = nrow(x7_county),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100)
ma_2024 |>
group_by(x7_county) |>
summarize(num_chems = nrow(x7_county),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100) |>
left_join(temp,
by = x7_county)
temp <- ma_2024 |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(!sum)
ma_2024 |>
group_by(x7_county) |>
summarize(num_chems = nrow(x7_county),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100) |>
left_join(temp,
by = x7_county)
ma_2024 |>
group_by(x7_county) |>
summarize(num_chems = nrow(x7_county),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100) |>
left_join(temp,
by = join_by(x7_county))
chemstats <- function(data, area = c("county", "city", "zip")) {
if (area == "county") {
temp <- data |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(!sum)
result <- data |>
group_by(x7_county) |>
summarize(num_chems = nrow(x7_county),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100) |>
left_join(temp,
by = join_by(x7_county))
}
}
chemstats(ma_2024, county)
chemstats(ma_2024, "county")
chemstats <- function(data, area = c("county", "city", "zip")) {
if (area == "county") {
temp <- data |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(!sum)
result <- data |>
group_by(x7_county) |>
summarize(num_chems = nrow(x7_county),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100) |>
left_join(temp,
by = join_by(x7_county))
result
}
}
chemstats(ma_2024, "county")
chemstats <- function(data, area = c("county", "city", "zip")) {
if (area == "county") {
temp <- data |>
group_by(x7_county, x23_industry_sector) |>
summarize(sum = n()) |>
arrange(desc(sum)) |>
slice(1) |>
select(!sum)
result <- data |>
group_by(x7_county) |>
summarize(num_chems = n(),
percent_carcinogen = (sum(x46_carcinogen == "YES") / n())*100,
percent_hazard = (sum(x42_clean_air_act_chemical == "NO") / n())*100) |>
left_join(temp,
by = join_by(x7_county))
result
}
}
chemstats(ma_2024, "county")
devtools::document()
devtools::document()
rm(chemstats)
devtools::document()
library(usmap)
install.packages("usmap")
library(usmap)
plot_usmap()
plot_usmap(regions = 'counties')
df <- ma_2024 |>
group_by(x7_county) |>
summarize(num = n())
plot_usmap(regions = 'counties',
data = df,
values = "num")
df <- ma_2024 |>
group_by(x7_county) |>
rename("county" = x7_county) |>
summarize(num = n())
plot_usmap(regions = 'counties',
data = df,
values = "num")
df
